<h1><%= t("admin.event_list") %></h1>

<p class="text-right">
<%= link_to "新增部门", new_admin_event_path, :class => "btn btn-primary" %>
</p>
<%= form_tag bulk_update_admin_events_path, :class => "form-inline" do %>
  <table class="table">
    <thead>
      <tr>
        <th><%= check_box_tag "全选", "1", false, :id => "toggle_all" %></th>
        <th>部门名称</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody class="sortable">
      <% @events.each do |event| %>
        <tr data-reorder-url="<%= reorder_admin_event_path(event) %>">
          <td>
            <%= check_box_tag "ids[]", event.id %>
          </td>
          <td>
            <span class="sortable_icon">☰</span>
            <%= link_to event.name, admin_event_path(event) %>
          </td>
          <td>
            <%= link_to "日志管理", admin_event_registrations_path(event), :class => "btn btn-default" %>
            <%= link_to "业务", admin_event_tickets_path(event), :class => "btn btn-default" %>
            <%= link_to "用户单位", admin_event_departments_path(event), :class => "btn btn-default" %>
            <%= link_to "编辑", edit_admin_event_path(event), :class => "btn btn-default" %>
            <%= link_to "删除", admin_event_path(event), :method => "delete", :data => { :confirm => "Are you sure?" }, :class => "btn btn-danger" %>
        </tr>
      <% end %>
    </tbody>
  </table>

  <p><%= submit_tag "批次删除", :class => "btn btn-danger", :data => { :confirm => "Are you sure?" } %></p>
<% end %>


<script>
    $("#toggle_all").click(function(){
      if ( $(this).prop("checked") ) {
        $("input[name='ids[]']").prop("checked", true);
      } else {
        $("input[name='ids[]']").prop("checked", false);
      }
    })

    $( ".sortable" ).sortable({
      axis: 'y',
      items: 'tr',
      cursor: 'move',
      handle: ".sortable_icon",
      stop: function(e, ui){
        ui.item.children('td').effect('highlight',  {}, 1000)
      },
      update: function(e, ui){
        reorder_url = ui.item.data('reorder-url')
        position = ui.item.index()
        $.ajax({
          type: 'POST',
          url: reorder_url,
          dataType: 'json',
          data: { position: position }
        })
      }
    });
</script>
